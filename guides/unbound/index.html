



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://docs.pi-hole.net/guides/unbound/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Pi-hole as All-Around DNS Solution - Pi-hole documentation for v4.0+</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#the-problem-whom-can-you-trust" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.pi-hole.net" title="Pi-hole documentation for v4.0+" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Pi-hole documentation for v4.0+
              </span>
              <span class="md-header-nav__topic">
                Pi-hole as All-Around DNS Solution
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/pi-hole/pi-hole/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.pi-hole.net" title="Pi-hole documentation for v4.0+" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Pi-hole documentation for v4.0+
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/pi-hole/pi-hole/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview & Support" class="md-nav__link">
      Overview & Support
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/prerequesites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/basic-install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/post-install/" title="Post-Install" class="md-nav__link">
      Post-Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/update/" title="Updating" class="md-nav__link">
      Updating
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      FTLDNS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        FTLDNS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/configfile/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/dns-resolver/" title="DNS resolver" class="md-nav__link">
      DNS resolver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/blockingmode/" title="Blocking mode" class="md-nav__link">
      Blocking mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      RegEx blocking
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        RegEx blocking
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/regex/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/regex/tutorial/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/privacylevels/" title="Privacy levels" class="md-nav__link">
      Privacy levels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/database/" title="Long-term database" class="md-nav__link">
      Long-term database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/telnet-api/" title="Telnet API" class="md-nav__link">
      Telnet API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/compile/" title="Install from source" class="md-nav__link">
      Install from source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/debugging/" title="Debugging FTLDNS" class="md-nav__link">
      Debugging FTLDNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ftldns/in-depth/" title="In-depth manual" class="md-nav__link">
      In-depth manual
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Pi-hole as All-Around DNS Solution
      </label>
    
    <a href="./" title="Pi-hole as All-Around DNS Solution" class="md-nav__link md-nav__link--active">
      Pi-hole as All-Around DNS Solution
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-whom-can-you-trust" title="The problem: Whom can you trust?" class="md-nav__link">
    The problem: Whom can you trust?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-recursive-dns-server" title="What is a recursive DNS server?" class="md-nav__link">
    What is a recursive DNS server?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-this-guide-provide" title="What does this guide provide?" class="md-nav__link">
    What does this guide provide?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-pi-hole-as-a-recursive-dns-server-solution" title="Setting up Pi-hole as a recursive DNS server solution" class="md-nav__link">
    Setting up Pi-hole as a recursive DNS server solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-unbound" title="Configure unbound" class="md-nav__link">
    Configure unbound
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-validation" title="Test validation" class="md-nav__link">
    Test validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-pi-hole" title="Configure Pi-hole" class="md-nav__link">
    Configure Pi-hole
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dns-over-https/" title="Configuring DNS-Over-HTTPS on Pi-hole" class="md-nav__link">
      Configuring DNS-Over-HTTPS on Pi-hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Pi-hole and OpenVPN Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Pi-hole and OpenVPN Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/setup-openvpn-server/" title="Setup OpenVPN Server" class="md-nav__link">
      Setup OpenVPN Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/firewall/" title="Firewall Configuration" class="md-nav__link">
      Firewall Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3-5" type="checkbox" id="nav-4-3-5">
    
    <label class="md-nav__link" for="nav-4-3-5">
      Connecting clients
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-3-5">
        Connecting clients
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/clients/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/android-client/" title="Android" class="md-nav__link">
      Android
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/only-dns-via-vpn/" title="Optional: Only route DNS via VPN" class="md-nav__link">
      Optional: Only route DNS via VPN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/dual-operation/" title="Optional: Dual operation: LAN & VPN at the same time" class="md-nav__link">
      Optional: Dual operation: LAN & VPN at the same time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/dual-VPN/" title="Optional: Full and DNS-only" class="md-nav__link">
      Optional: Full and DNS-only
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpn/dynDNS/" title="Optional: Dynamic DNS" class="md-nav__link">
      Optional: Dynamic DNS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-whom-can-you-trust" title="The problem: Whom can you trust?" class="md-nav__link">
    The problem: Whom can you trust?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-recursive-dns-server" title="What is a recursive DNS server?" class="md-nav__link">
    What is a recursive DNS server?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-this-guide-provide" title="What does this guide provide?" class="md-nav__link">
    What does this guide provide?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-pi-hole-as-a-recursive-dns-server-solution" title="Setting up Pi-hole as a recursive DNS server solution" class="md-nav__link">
    Setting up Pi-hole as a recursive DNS server solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-unbound" title="Configure unbound" class="md-nav__link">
    Configure unbound
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-validation" title="Test validation" class="md-nav__link">
    Test validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-pi-hole" title="Configure Pi-hole" class="md-nav__link">
    Configure Pi-hole
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Pi-hole as All-Around DNS Solution</h1>
                
                <h3 id="the-problem-whom-can-you-trust">The problem: Whom can you trust?<a class="headerlink" href="#the-problem-whom-can-you-trust" title="Permanent link">&para;</a></h3>
<p>Pi-hole includes a caching and <em>forwarding</em> DNS server, now known as <em>FTL</em>DNS. After applying the blocking lists, it forwards requests made by the clients to configured upstream DNS server(s). However, as has been mentioned by several users in the past, this leads to some privacy concerns as it ultimately raises the question: <em>Whom can you trust?</em> Recently, more and more small (and not so small) DNS upstream providers have appeared on the market, advertising free and private DNS service, but how can you know that they keep their promises? Right, you can't.</p>
<p>Furthermore, from the point of an attacker, the DNS servers of larger providers are very worthwhile targets, as they only need to poison one DNS server, but millions of users might be affected. Instead of your bank's actual IP address, you could be sent to a phishing site hosted on some island. This scenario has <a href="https://www.zdnet.com/article/dns-cache-poisoning-attacks-exploited-in-the-wild/">already happened</a> and it isn't unlikely to happen again...</p>
<p>When you operate your own (tiny) recursive DNS server, then the likeliness of getting affected by such an attack is greatly reduced.</p>
<h3 id="what-is-a-recursive-dns-server">What <em>is</em> a recursive DNS server?<a class="headerlink" href="#what-is-a-recursive-dns-server" title="Permanent link">&para;</a></h3>
<p>The first distinction we have to be aware of is whether a DNS server is <em>authoritative</em> or not.  If I'm the authoritative server for, e.g., <code>pi-hole.net</code>, then I know which IP is the correct answer for a query. Recursive name servers, in contrast, resolve any query they receive by consulting the servers authoritative for this query by traversing the domain.
Example: We want to resolve <code>pi-hole.net</code>. On behalf of the client, the recursive DNS server will traverse the path of the domain across the Internet to deliver the answer to the question.</p>
<h3 id="what-does-this-guide-provide">What does this guide provide?<a class="headerlink" href="#what-does-this-guide-provide" title="Permanent link">&para;</a></h3>
<p>In only a few simple steps, we will describe how to set up your own recursive DNS server. It will run on the same device you're already using for your Pi-hole. There are no additional hardware requirements.</p>
<p>This guide assumes a fairly recent Debian/Ubuntu based system and will use the maintainer provided packages for installation to make it an incredibly simple process. It assumes only very basic knowledge of how DNS works.</p>
<p>A <em>standard</em> Pi-hole installation will do it as follows:</p>
<ol>
<li>Your client asks the Pi-hole <code>Who is pi-hole.net</code>?</li>
<li>Your Pi-hole will check its cache and reply if the answer is already known.</li>
<li>Your Pi-hole will check the blocking lists and reply if the domain is blocked.</li>
<li>Since neither 2. nor 3. is true in our example, the Pi-hole forwards the request to the configured <em>external</em> upstream DNS server(s).</li>
<li>Upon receiving the answer, your Pi-hole will reply to your client and tell it the answer of its request.</li>
<li>Lastly, your Pi-hole will save the answer in its cache to be able to respond faster if <em>any</em> of your clients queries the same domain again.</li>
</ol>
<p>After you set up your Pi-hole as described in this guide, this procedure changes notably:</p>
<ol>
<li>Your client asks the Pi-hole <code>Who is pi-hole.net</code>?</li>
<li>Your Pi-hole will check its cache and reply if the answer is already known.</li>
<li>Your Pi-hole will check the blocking lists and reply if the domain is blocked.</li>
<li>Since neither 2. nor 3. is true in our example, the Pi-hole delegates the request to the (local) recursive DNS resolver.</li>
<li>Your recursive server will send a query to the DNS root servers: "Who is handling <code>.net</code>?"</li>
<li>The root server answers with a referral to the TLD servers for <code>.net</code>.</li>
<li>Your recursive server will send a query to one of the TLD DNS servers for <code>.net</code>: "Who is handling <code>pi-hole.net</code>?"</li>
<li>The TLD server answers with a referral to the authoritative name servers for <code>pi-hole.net</code>.</li>
<li>Your recursive server will send a query to the authoritative name servers: "What is the IP of <code>pi-hole.net</code>?"</li>
<li>The authoritative server will answer with the IP address of the domain <code>pi-hole.net</code>.</li>
<li>Your recursive server will send the reply to your Pi-hole which will, in turn, reply to your client and tell it the answer of its request.</li>
<li>Lastly, your Pi-hole will save the answer in its cache to be able to respond faster if <em>any</em> of your clients queries the same domain again.</li>
</ol>
<p>You can easily imagine even longer chains for subdomains as the query process continues until your recursive resolver reaches the authoritative server for the zone that contains the queried domain name. It is obvious that the methods are very different and the own recursion is more involved than "just" asking some upstream server. This has benefits and drawbacks:</p>
<ul>
<li>
<p>Benefit: Privacy - as you're directly contacting the responsive servers, no server can fully log the exact paths you're going, as e.g. the Google DNS servers will only be asked if you want to visit a Google website, but not if you visit the website of your favorite newspaper, etc.</p>
</li>
<li>
<p>Drawback: Traversing the path may be slow, especially for the first time you visit a website - while the bigger DNS providers always have answers for commonly used domains in their cache, you will have to transverse the path if you visit a page for the first time time. A first request to a formerly unknown TLD may take up to a second (or even more if you're also using DNSSEC). Subsequent requests to domains under the same TLD usually complete in <code>&lt; 0.1s</code>.
Fortunately, both your Pi-hole as well as your recursive server will be configured for efficient caching to minimize the number of queries that will actually have to be performed.</p>
</li>
</ul>
<h2 id="setting-up-pi-hole-as-a-recursive-dns-server-solution">Setting up Pi-hole as a recursive DNS server solution<a class="headerlink" href="#setting-up-pi-hole-as-a-recursive-dns-server-solution" title="Permanent link">&para;</a></h2>
<p>We will use <a href="https://www.unbound.net/"><code>unbound</code></a>, a secure open source recursive DNS server primarily developed by NLnet Labs, VeriSign Inc., Nominet, and Kirei.
The first thing you need to do is to install the recursive DNS resolver:
<div class="codehilite"><pre><span></span>sudo apt install unbound
</pre></div></p>
<p>Optional: Download the list of primary root servers (serving the domain <code>.</code>). Unbound ships its own list but we can also download the most recent list and update it whenever we think it is a good idea. Note: there is no point in doing it more often then every 6 months.
<div class="codehilite"><pre><span></span>wget -O root.hints https://www.internic.net/domain/named.root 
sudo mv root.hints /var/lib/unbound/
</pre></div></p>
<h3 id="configure-unbound">Configure <code>unbound</code><a class="headerlink" href="#configure-unbound" title="Permanent link">&para;</a></h3>
<p>Highlights:
- Listen only for queries from the local Pi-hole installation (on port 5353)
- Listen for both UDP and TCP requests
- Verify DNSSEC signatures, discarding BOGUS domains
- Apply a few security and privacy tricks</p>
<p><code>/etc/unbound/unbound.conf.d/pi-hole.conf</code>:
<div class="codehilite"><pre><span></span><span class="na">server:</span>
    <span class="na">verbosity: 1</span>
    <span class="na">port: 5353</span>
    <span class="na">do-ip4: yes</span>
    <span class="na">do-udp: yes</span>
    <span class="na">do-tcp: yes</span>

    <span class="c1"># May be set to yes if you have IPv6 connectivity</span>
    <span class="na">do-ip6: no</span>

    <span class="c1"># Use this only when you downloaded the list of primary root servers!</span>
    <span class="na">root-hints: &quot;/var/lib/unbound/root.hints&quot;</span>

    <span class="c1"># Trust glue only if it is within the servers authority</span>
    <span class="na">harden-glue: yes</span>

    <span class="c1"># Require DNSSEC data for trust-anchored zones, if such data is absent, the zone becomes BOGUS</span>
    <span class="na">harden-dnssec-stripped: yes</span>

    <span class="c1"># Don&#39;t use Capitalization randomization as it known to cause DNSSEC issues sometimes</span>
    <span class="c1"># see https://discourse.pi-hole.net/t/unbound-stubby-or-dnscrypt-proxy/9378 for further details</span>
    <span class="na">use-caps-for-id: no</span>

    <span class="c1"># Reduce EDNS reassembly buffer size.</span>
    <span class="c1"># Suggested by the unbound man page to reduce fragmentation reassembly problems</span>
    <span class="na">edns-buffer-size: 1472</span>

    <span class="c1"># TTL bounds for cache</span>
    <span class="na">cache-min-ttl: 3600</span>
    <span class="na">cache-max-ttl: 86400</span>

    <span class="c1"># Perform prefetching of close to expired message cache entries</span>
    <span class="c1"># This only applies to domains that have been frequently queried</span>
    <span class="na">prefetch: yes</span>

    <span class="c1"># One thread should be sufficient, can be increased on beefy machines</span>
    <span class="na">num-threads: 1</span>

    <span class="c1"># Ensure kernel buffer is large enough to not loose messages in traffic spikes</span>
    <span class="na">so-rcvbuf: 1m</span>

    <span class="c1"># Ensure privacy of local IP ranges</span>
    <span class="na">private-address: 192.168.0.0/16</span>
    <span class="na">private-address: 172.16.0.0/12</span>
    <span class="na">private-address: 10.0.0.0/8</span>
</pre></div></p>
<p>Start your local recursive server and test that it's operational:
<div class="codehilite"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">unbound</span> <span class="n">start</span>
<span class="n">dig</span> <span class="n">pi</span><span class="o">-</span><span class="n">hole</span><span class="p">.</span><span class="n">net</span> <span class="mf">@127.0.0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5353</span>
</pre></div>
The first query may be quite slow, but subsequent queries, also to other domains under the same TLD, should be fairly quick.</p>
<h3 id="test-validation">Test validation<a class="headerlink" href="#test-validation" title="Permanent link">&para;</a></h3>
<p>You can test DNSSEC validation using
<div class="codehilite"><pre><span></span><span class="n">dig</span> <span class="n">sigfail</span><span class="p">.</span><span class="n">verteiltesysteme</span><span class="p">.</span><span class="n">net</span> <span class="mf">@127.0.0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5353</span>
<span class="n">dig</span> <span class="n">sigok</span><span class="p">.</span><span class="n">verteiltesysteme</span><span class="p">.</span><span class="n">net</span> <span class="mf">@127.0.0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5353</span>
</pre></div>
The first command should give a status report of <code>SERVFAIL</code> and no IP address. The second should give <code>NOERROR</code> plus an IP address.</p>
<h3 id="configure-pi-hole">Configure Pi-hole<a class="headerlink" href="#configure-pi-hole" title="Permanent link">&para;</a></h3>
<p>Finally, configure Pi-hole to use your recursive DNS server:</p>
<p><img alt="screenshot at 2018-04-18" src="../../images/RecursiveResolver.png" /></p>
<p>(don't forget to hit Return or click on <code>Save</code>)</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../ftldns/in-depth/" title="In-depth manual" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                In-depth manual
              </span>
            </div>
          </a>
        
        
          <a href="../dns-over-https/" title="Configuring DNS-Over-HTTPS on Pi-hole" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configuring DNS-Over-HTTPS on Pi-hole
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Pi-hole LLC
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://pi-hole.net" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/pi-hole" class="md-footer-social__link fa fa-github-alt"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>